{% extends "tracking/base.html" %}
{% block title %}Llenados{% endblock %}

{% block content %}

<!-- =========================
     HEADER
========================= -->
<div class="header-row">
  <h1>Productos en llenado</h1>

  <a href="{% url 'tracking:products' %}"
     class="btn-secondary">
    ← Volver a productos
  </a>
</div>

<!-- =========================
     FILTROS (MISMO ESTILO QUE PRODUCTOS)
========================= -->
<div class="content-card filters-row">
  <form method="get">

    <!-- Encargada -->
    <label>
      Encargada
      <select name="encargada">
        <option value="">Todas</option>
        {% for e in encargadas %}
          <option value="{{ e.id }}"
            {% if filters.encargada == e.id|stringformat:"s" %}selected{% endif %}>
            {{ e.name }}
          </option>
        {% endfor %}
      </select>
    </label>

    <!-- Medida -->
    <label>
      Medida
      <select name="size">
        <option value="">Todas</option>
        {% for s in sizes %}
          <option value="{{ s }}"
            {% if filters.size == s %}selected{% endif %}>
            {{ s }}
          </option>
        {% endfor %}
      </select>
    </label>

    <!-- Producto -->
    <label>
      Producto
      <input type="text"
             name="product_type"
             value="{{ filters.product_type|default:'' }}"
             placeholder="Ej: Plumón">
    </label>

    <!-- Botones -->
    <button class="btn-primary" type="submit">
      Filtrar
    </button>

    <a href="{% url 'tracking:llenados' %}" class="btn-secondary">
      Limpiar
    </a>

  </form>
</div>

<!-- =========================
     TABLA
========================= -->
<div class="content-card">
  <table class="admin-table">
    <thead>
      <tr>
        <th>Código</th>
        <th>Producto</th>
        <th>Variante</th>
        <th>Medida</th>
        <th>Encargada actual</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for p in products %}
      <tr>
        <td>{{ p.code }}</td>
        <td>{{ p.product_type }}</td>
        <td>{{ p.variant }}</td>
        <td>{{ p.size }}</td>
        <td>{{ p.processes.last.assigned_to }}</td>
        <td>
          <a href="{% url 'tracking:product_detail' p.id %}">
            Ver
          </a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6">
          No hay productos actualmente en llenado
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
